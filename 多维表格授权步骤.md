# 多维表格授权步骤

## 问题现象

API返回错误：
```
code: 99991672
msg: 'Access denied. One of the following scopes is required: [bitable:app:readonly, bitable:app, base:record:retrieve]'
```

即使应用已经配置了 `bitable:app:readonly` 权限并发布了版本，仍然无法访问多维表格。

## 原因分析

飞书的权限分为两层：
1. **应用权限**（已完成）：在飞书开放平台配置应用的API权限
2. **资源授权**（需要完成）：将具体的多维表格授权给应用访问

## 解决方案：为多维表格添加应用协作者

### 方法一：通过多维表格界面添加

1. **打开多维表格**
   - 在飞书中打开"降噪内容库"
   - 或访问：`https://[你的域名].feishu.cn/base/FD0uwEbNTiWpgBkOSc1cxBslnQc`

2. **添加机器人/应用为协作者**
   - 点击右上角"协作"或"分享"按钮
   - 在搜索框输入应用名称："降噪内容管理"
   - 或者输入：`cli_a989e0fcbd7f100c`
   - 找到应用后点击添加
   - 设置权限为"可阅读"或"可编辑"（至少需要可阅读）
   - 点击确认

3. **验证**
   - 检查协作者列表中是否出现了应用
   - 应用图标旁边应该有"机器人"或"应用"的标识

### 方法二：通过飞书管理后台

1. **访问飞书管理后台**
   - https://[你的域名].feishu.cn/admin

2. **找到多维表格权限设置**
   - 工作台 → 多维表格 → 找到"降噪内容库"
   - 点击设置或权限管理

3. **添加应用访问权限**
   - 添加机器人/应用
   - 输入 App ID：`cli_a989e0fcbd7f100c`
   - 保存

## 验证授权是否成功

授权完成后，在项目目录运行测试脚本：

```bash
cd jiangzao
node scripts/test-feishu.js
```

如果看到以下输出，说明授权成功：
```
✅ API调用成功!
📊 获取到的数据:
   - 总记录数: X
   - 是否有更多: 否
🎉 飞书API配置正确！可以正常使用。
```

## 常见问题

### Q: 搜索不到应用名称怎么办？

A: 尝试以下方法：
1. 直接输入 App ID：`cli_a989e0fcbd7f100c`
2. 在飞书开放平台确认应用已启用
3. 检查是否在正确的企业/团队空间中

### Q: 添加后仍然报错怎么办？

A:
1. 等待1-2分钟让权限生效
2. 重启开发服务器
3. 清除浏览器缓存
4. 检查应用状态是否为"已启用"

### Q: 找不到"协作"按钮？

A:
1. 确保您有多维表格的管理权限
2. 尝试从多维表格设置中找到"成员管理"或"协作者"
3. 联系多维表格的创建者或管理员帮助添加

## 参考文档

- 飞书开放平台 - 多维表格权限说明：https://open.feishu.cn/document/server-docs/docs/bitable-v1/notification
- 权限问题排查：https://open.feishu.cn/document/ukTMukTMukTM/uQjN3QjL0YzN04CN2cDN
